function scrollTo(a){$("html, body").animate({scrollTop:a.offset().top},2e3)}function imgpopover_getTitle(){var a=uploader.getFile($(this).data("file"));return a.name}function imgpopover_getContent(){var a=uploader.getFile($(this).data("file")),b=a.getSource(),c=new mOxie.Image;return c.onload=function(){$("#img"+a.id).attr("src",this.getAsDataURL())},c.load(b),'<img id="img'+a.id+'" class="img-responsive" />'}function on_keyboard_action(a){k=a.keyCode,17==k&&(0==ctrl_pressed&&(ctrl_pressed=!0),window.Clipboard||pasteCatcher.focus())}function on_keyboardup_action(a){k=a.keyCode,17==k&&(ctrl_pressed=!1)}function dataURLtoBlob(a){for(var b=a.split(","),c=b[0].match(/:(.*?);/)[1],d=atob(b[1]),e=d.length,f=new Uint8Array(e);e--;)f[e]=d.charCodeAt(e);return new Blob([f],{type:c})}function pasteHandler(a){if(a.clipboardData){var b=a.clipboardData.items;if(b)for(var c=0;c<b.length;c++)if(-1!==b[c].type.indexOf("image")){var d=b[c].getAsFile();paste_createImage(d)}}else setTimeout(paste_check_Input,1)}function paste_check_Input(){var a=pasteCatcher.childNodes[0];pasteCatcher.innerHTML="",a&&"IMG"===cild.tagName&&paste_createImage(a.src)}function pad(a){return("0"+a).slice(-2)}function getDateString(){var a=new Date;return a.getFullYear()+"-"+pad(a.getMonth()+1)+"-"+pad(a.getDate())+"_"+pad(a.getHours())+pad(a.getMinutes())+pad(a.getSeconds())}function getExtension(a){switch(a.type){case"image/gif":return".gif";case"image/jpeg":return".jpg";case"image/png":return".png";case"image/bmp":return".bmp"}}function paste_createImage(a){var b=(new mOxie.Image,new mOxie.File(null,a));b.name="clipboard-"+getDateString()+getExtension(a),uploader.addFile(b)}function onGooglePlatformSignIn(a){var b=a.getAuthResponse().id_token,c=$("#g-signin-button").data("loginpage");$.post(c,{id_token:b},function(a){if("undefined"!=typeof a.status&&"ok"==a.status){var b=$("#site-navigation").data("reload");$.get(b,function(a){$("#site-navigation").replaceWith(a)})}else signOut()})}function onGooglePlatformLoaded(){gapi.load("auth2",function(){gapi.auth2.init();gapi.signin2.render("g-signin-button",{scope:"email",onsuccess:onGooglePlatformSignIn})})}function serverSignOut(){var a=$("#g-signout-button").data("logoutpage");$.get(a,function(a){location.reload(!0)})}function signOut(){var a=gapi.auth2.getAuthInstance();a.signOut().then(serverSignOut)}if("undefined"!=typeof blueimp&&($("#blueimp-gallery").on("open",function(a){$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no")}).on("closed",function(a){$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1")}).on("slide",function(a,b,c){var d=$("#blueimp-gallery").data("gallery"),e=$(d.list[b]);$.bbq.pushState({viewer:e.data("id")})}).on("close",function(a,b){$.bbq.removeState("viewer")}),$(window).hashchange(function(){var a=$("#blueimp-gallery").data("gallery");if("undefined"!=typeof a){var b=$.bbq.getState("viewer");if("undefined"==typeof b)return void a.close();for(var c=0;c<a.list.length;c++){var d=$(a.list[c]);if(d.data("id")==b){a.getIndex()!=c&&a.slide(c);break}}}}),$(document).ready(function(){var a=$.bbq.getState("viewer");"undefined"!=typeof a&&$('a[data-id="'+a+'"').click()})),"undefined"!=typeof plupload){var redirect=window.location.href,uploading=!1,uploader=new plupload.Uploader({browse_button:"pickfiles",url:"upload/",container:"uploadform",drop_element:"dropbox",multipart:!0,runtimes:"html5,html4",init:{PostInit:function(){$("#upoad").click(function(){uploading=!0,$("body").append('<div id="hide" />'),$("#pickfiles").prop("disabled",!0),$("#upoad").prop("disabled",!0),$("#inputtags").prop("disabled",!0),uploader.settings.multipart_params={tags:$("#inputtags").val(),uploadid:$("#uploadform").data("uploadid"),csrf_token:$("#uploadform").data("csrf"),submit:"Upload"},uploader.start()})},FilesAdded:function(a,b){$("#image-list").show(),$.each(b,function(a,b){$("#image-list").append('<div id="'+b.id+'">');var c=$("#"+b.id);c.append(b.name+" ("+plupload.formatSize(b.size)+") "),c.append('<a tabindex="0" role="button" class="img-popover" data-toggle="popover" data-file="'+b.id+'"><span class="glyphicon glyphicon-picture" aria-hidden="true"></span></a>')}),a.refresh()},UploadFile:function(a,b){var c=$("#"+b.id);c.html(b.name+' <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>'),scrollTo(c),c.after('<div id="'+b.id+'progress" />'),$("#"+b.id+"progress").addClass("progress").append('<div class="progress-bar"role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" />')},UploadProgress:function(a,b){$("#"+b.id+"progress .progress-bar").css("width",b.percent+"%").html(b.percent+" %")},Error:function(a,b){$("#"+b.file.id+"progress").remove(),$("#"+b.file.id).html(b.file.name+' <span class="glyphicon glyphicon-remove-sign upload-error" aria-hidden="true"></span>'),a.refresh()},FileUploaded:function(a,b,c){$("#"+b.id+"progress").remove();var d=JSON.parse(c.response);return"undefined"==typeof d.status||"ok"!=d.status?(a.trigger("Error",{message:d.error.message,code:d.error.code,file:b}),!1):(redirect=d.redirect,void $("#"+b.id).html(b.name+' <span class="glyphicon glyphicon-ok-sign upload-success" aria-hidden="true"></span>'))},UploadComplete:function(a,b){window.location=redirect}}});uploader.init(),window.addEventListener("dragenter",function(a){uploading||(a.stopPropagation(),a.preventDefault(),$("#dropbox").fadeIn())},!1);var dropbox=document.getElementById("dropbox"),dropboxHideTimer;dropbox.addEventListener("dragover",function(a){a.stopPropagation(),a.preventDefault(),clearTimeout(dropboxHideTimer),dropboxHideTimer=setTimeout("$('#dropbox').fadeOut();",250)},!1),$("body").popover({html:!0,trigger:"hover focus",selector:".img-popover",template:'<div class="popover" role="tooltip"><h3 class="popover-title"></h3><div class="popover-content"></div></div>',title:imgpopover_getTitle,content:imgpopover_getContent}),document.onkeydown=function(a){return on_keyboard_action(a)},document.onkeyup=function(a){return on_keyboardup_action(a)};var ctrl_pressed=!1,pasteCatcher;window.Clipboard||(pasteCatcher=document.createElement("div"),pasteCatcher.setAttribute("id","paste_ff"),pasteCatcher.setAttribute("contenteditable",""),pasteCatcher.style.cssText="opacity:0;position:fixed;top:0px;left:0px;",pasteCatcher.style.marginLeft="-20px",document.body.appendChild(pasteCatcher),pasteCatcher.focus(),document.getElementById("paste_ff").addEventListener("DOMSubtreeModified",function(){if(1==pasteCatcher.children.length){img=pasteCatcher.firstElementChild.src;var a=dataURLtoBlob(img);paste_createImage(a),pasteCatcher.innerHTML=""}},!1)),window.addEventListener("paste",pasteHandler)}$("#g-signout-button").click(function(){signOut()}),"undefined"!=typeof $.fn.select2&&$("#inputtags").select2({tags:!0,tokenSeparators:[","],ajax:{delay:250,processResults:function(a,b){return{results:a}}}});